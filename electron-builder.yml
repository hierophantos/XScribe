appId: com.xscribe.app
productName: XScribe
directories:
  buildResources: build
  output: release

files:
  - out/**/*
  - "!out/**/*.map"
  - "!node_modules/**/*"
  - node_modules/@electron-toolkit/**/*
  - node_modules/better-sqlite3/**/*
  - node_modules/bindings/**/*
  - node_modules/file-uri-to-path/**/*
  - node_modules/ffmpeg-static/**/*

asarUnpack:
  - resources/**
  - node_modules/better-sqlite3/**/*.node
  - node_modules/better-sqlite3/build/**/*
  - node_modules/ffmpeg-static/ffmpeg
  - node_modules/ffmpeg-static/ffmpeg.exe

extraResources:
  # Bundled Python venv (pre-built in CI with all dependencies)
  # This is extracted from python-venv-{platform}.tar.gz during release build
  - from: python-bundled/
    to: python/
    filter:
      - "**/*"
      - "!**/__pycache__/**"
      - "!**/tests/**"
      - "!**/test/**"
      - "!**/*.pyc"
      - "!**/*.pyi"
  # NO models bundled - user downloads on first use:
  # - Whisper models: tiny.en (38MB) to large-v3-turbo (1.6GB)
  # - Diarization models: sherpa-onnx (~50MB)

mac:
  # ARM64 only - Intel Macs can run via Rosetta 2
  # PyTorch 2.8+ is not available for x86_64 macOS
  target:
    - target: dmg
      arch:
        - arm64
    - target: zip
      arch:
        - arm64
  category: public.app-category.productivity
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: build/entitlements.mac.plist
  entitlementsInherit: build/entitlements.mac.plist
  notarize: false

win:
  target:
    - target: nsis
      arch:
        - x64
    - target: portable
      arch:
        - x64
  artifactName: ${name}-${version}-${arch}.${ext}

nsis:
  oneClick: false
  perMachine: false
  allowToChangeInstallationDirectory: true
  deleteAppDataOnUninstall: false

linux:
  # x64 only for now - arm64 can be added when we build linux-arm64 venv
  target:
    - target: AppImage
      arch:
        - x64
    - target: deb
      arch:
        - x64
  category: AudioVideo
  maintainer: xscribe

npmRebuild: true
nodeGypRebuild: false

publish:
  provider: github
  owner: hierophantos
  repo: XScribe
  releaseType: release
